<div class="container-new-booking">

  <script>
    function calcPrice() {
      // calculations
      const pricePerUnit = document.getElementById("booking_price_per_unit").value;
      const unitQuantity = document.getElementById("booking_quantity").value;

      const bookingFee = Math.round((((pricePerUnit) * unitQuantity) * 0.15)*100) / 100;
      document.getElementById('store-fee').innerHTML = "Store's Insurance Policy Fee: €" + bookingFee.toString();

      // updating HTML
      document.getElementById('total-cost').innerHTML = "Total Cost: €" + (Math.round(((pricePerUnit * unitQuantity) + bookingFee) * 100) / 100).toString();
      if (unitQuantity === "") {
        document.getElementById('total-cost').innerHTML = "Total Cost: €0";
      }
    }

  </script>

  <div class="booking-new-form">
    <h2> Make a Booking </h2>
    <%= simple_form_for([@store, @booking]) do |f| %>
      <%#= f.input :category, label: "Item type" %> <!-- Not using anymore -->
      <%= f.input :name, label: "Item Name", maxlength: 30, required: true %>
      <div class="booking-new-double-column">
        <%= f.input :price_per_unit, input_html: { min: '0', step: '0.01' }, value: number_with_precision(f.object.price_per_unit, precision: 2), input_html: { class: "fill-column-space" }, required: true %>
        <%= f.input :quantity, label: "Amount of units", input_html: { class: "fill-column-space" }, required: true %>
      </div>
      <!-- Hidden fields we calculate -->
      <%= f.input :booking_fee, as: :hidden %>
      <p id="store-fee">Store Insurance Policy Fee: </p>
      <%= f.input :total_price, as: :hidden %>
      <p id="total-cost">Total Cost: </p>

      <%= f.input :photo %>
      <%= f.input :photo_cache, as: :hidden %>
      <div class="booking-new-double-column">
        <%= f.input :start_date, as: :string, input_html: { class: "datepicker" }, required: true %>
        <%= f.input :end_date, as: :string, input_html: { class: "datepicker" }, required: true %>
      </div>
      <%= f.input :comment, label: "Message" %>
      <div class = "booking-new-submit">
        <%= link_to "Back", :back, class: "button button-small button-red" %>
        <%= f.submit "Book", class: "button button-medium button-green" %>
      </div>
    <% end %>
  </div>

  <!-- Has to be below the form, otherwise the form breaks because the function is confused -->
  <script>
    // updates when quantity is changed
    const quantity = document.querySelector("#booking_quantity");
    quantity.addEventListener('keyup', (event) => {
      calcPrice();
    });
    //  Updates when price per unit is changed
    const price_per_unit = document.querySelector("#booking_price_per_unit");
    price_per_unit.addEventListener('keyup', (event) => {
      calcPrice();
    });
  </script>

</div>
