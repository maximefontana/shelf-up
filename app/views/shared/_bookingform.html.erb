<div>
  <script>
    function calcPrice() {
      // calculations
      const pricePerUnit = document.getElementById("booking_price_per_unit").value;
      const unitQuantity = document.getElementById("booking_quantity").value;

      const bookingFee = Math.round((((pricePerUnit) * unitQuantity) * 0.15)*100) / 100;
      document.getElementById('store-fee').innerHTML = "Fee: €" + bookingFee.toString();

      // updating HTML
      document.getElementById('total-cost').innerHTML = "Total: €" + (Math.round(((pricePerUnit * unitQuantity) + bookingFee) * 100) / 100).toString();
      if (unitQuantity === "") {
        document.getElementById('total-cost').innerHTML = "Total Cost: €0";
      }
    }
  </script>

  <div class="booking-new-form">
    <div class="form-title">
      REQUEST
    </div>
    <%= simple_form_for([@store, @booking]) do |f| %>
    <div class="booking-form-row-one">
      <div class="booking-form-name">
        <%= f.input :name, label: "Name", maxlength: 30, required: true %>
      </div>
      <div class="booking-form-start-date">
        <%= f.input :start_date, label: "Start", as: :string, input_html: { class: "datepicker" }, required: true %>
      </div>
      <div class="booking-form-end-date">
        <%= f.input :end_date, label: "End", as: :string, input_html: { class: "datepicker" }, required: true %>
      </div>
    </div>

    <div class="booking-form-row-two">
      <div class="price-per-unit">
        <%= f.input :price_per_unit, label: "Price/Unit", input_html: { min: '0', step: '0.01' }, value: number_with_precision(f.object.price_per_unit, precision: 2), required: true %>
      </div>
      <div class="booking-quantity">
        <%= f.input :quantity, label: "Quantity", required: true %>
      </div>
    </div>

    <div class="booking-form-row-three">
      <!-- Hidden fields we calculate -->
      <div id="total-cost">
        Total:<%= f.input :total_price, label: "Total:", as: :hidden %>
      </div>
      <div id="store-fee">
        Fee:<%= f.input :booking_fee, label: "Fee:", as: :hidden %>
      </div>
    </div>
    <div class="booking-photo">
      <%= f.input :photo, label: "Photo:" %>
      <%= f.input :photo_cache, as: :hidden %>
    </div>

    <div class = "booking-new-submit">
      <a class="booking-form-message-button button button-small button-blue" href="#">Message</a>
      <%= f.submit "Book", class: "button button-medium button-green" %>
    </div>
      <div class ="booking-form-message-box hidden">
      <%= f.input :comment, label: "Message" %>
    <% end %>
  </div>

  <!-- Has to be below the form, otherwise the form breaks because the function is confused -->
  <script>
    // updates when quantity is changed
    const quantity = document.querySelector("#booking_quantity");
    quantity.addEventListener('keyup', (event) => {
      calcPrice();
    });
    //  Updates when price per unit is changed
    const price_per_unit = document.querySelector("#booking_price_per_unit");
    price_per_unit.addEventListener('keyup', (event) => {
      calcPrice();
    });
  </script>
</div>
